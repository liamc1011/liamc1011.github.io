<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="assets/styles/list-page.css">
    <title>Liam Chen</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
	<link rel="manifest" href="assets/favicon/site.webmanifest">
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="mainDialog">
            <div id="passArea">
                <p id="passwordPrompt">password please 😎</p>
                <div id="password-line">
                    <input id="pass" type="password" name="pass" autofocus>
                    <button id="submitPass" type="button">➜</button>
                </div>
            </div>
            <div id="error-message-wrapper">
                    <span id="blank-placeholder" class="placeholder bottom-message">&#8203</span>
                    <span id="invalidPass" class="error bottom-message">You suck!</span>
                    <span id="trycatcherror" class="error bottom-message">Sorry, something went wrong.</span>
                    <span id="success" class="notifyText bottom-message">Success!</span>
            </div>
            <div id="securecontext" class="error">
                <p>Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.</p>
            </div>
            <div id="nocrypto" class="error">
                <p>Your web browser appears to be outdated. Please visit this page using a modern browser.</p>
            </div>
        </div>
</div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        var placeholder = document.getElementById('blank-placeholder');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                // successEl.style.display = "block";   //deleted by me
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 50); //changed by me from 1000 to 50
            } catch (e) {
                invalidPassEl.style.display = "block";  //i changed from display:inline to display:block
                placeholder.style.display = "none"; //added by me
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            placeholder.style.display = "block";    //added by me
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
