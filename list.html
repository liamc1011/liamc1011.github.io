<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="assets/styles/list-page.css">
    <title>Liam Chen</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
	<link rel="manifest" href="assets/favicon/site.webmanifest">
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="mainDialog">
            <div id="passArea">
                <p id="passwordPrompt">password please 😎</p>
                <div id="password-line">
                    <input id="pass" type="password" name="pass" autofocus>
                    <button id="submitPass" type="button">➜</button>
                </div>
            </div>
            <div id="error-message-wrapper">
                    <span id="blank-placeholder" class="placeholder bottom-message">&#8203</span>
                    <span id="invalidPass" class="error bottom-message">You suck!</span>
                    <span id="trycatcherror" class="error bottom-message">Sorry, something went wrong.</span>
                    <span id="success" class="notifyText bottom-message">Success!</span>
            </div>
            <div id="securecontext" class="error">
                <p>Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.</p>
            </div>
            <div id="nocrypto" class="error">
                <p>Your web browser appears to be outdated. Please visit this page using a modern browser.</p>
            </div>
        </div>
</div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        var placeholder = document.getElementById('blank-placeholder');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                // successEl.style.display = "block";   //deleted by me
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 50); //changed by me from 1000 to 50
            } catch (e) {
                invalidPassEl.style.display = "block";  //i changed from display:inline to display:block
                placeholder.style.display = "none"; //added by me
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            placeholder.style.display = "block";    //added by me
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
