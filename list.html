<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="assets/styles/list-page.css">
    <title>Liam Chen</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
	<link rel="manifest" href="assets/favicon/site.webmanifest">
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="mainDialog">
            <div id="passArea">
                <p id="passwordPrompt">password please 😎</p>
                <div id="password-line">
                    <input id="pass" type="password" name="pass" autofocus>
                    <button id="submitPass" type="button">➜</button>
                </div>
            </div>
            <div id="error-message-wrapper">
                    <span id="blank-placeholder" class="placeholder bottom-message">&#8203</span>
                    <span id="invalidPass" class="error bottom-message">You suck!</span>
                    <span id="trycatcherror" class="error bottom-message">Sorry, something went wrong.</span>
                    <span id="success" class="notifyText bottom-message">Success!</span>
            </div>
            <div id="securecontext" class="error">
                <p>Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.</p>
            </div>
            <div id="nocrypto" class="error">
                <p>Your web browser appears to be outdated. Please visit this page using a modern browser.</p>
            </div>
        </div>
</div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        var placeholder = document.getElementById('blank-placeholder');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                // successEl.style.display = "block";   //deleted by me
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 50); //changed by me from 1000 to 50
            } catch (e) {
                invalidPassEl.style.display = "block";  //i changed from display:inline to display:block
                placeholder.style.display = "none"; //added by me
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            placeholder.style.display = "block";    //added by me
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
