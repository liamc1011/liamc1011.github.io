<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="assets/styles/list-page.css">
    <title>Liam Chen</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
	<link rel="manifest" href="assets/favicon/site.webmanifest">
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="mainDialog">
            <div id="passArea">
                <p id="passwordPrompt">password please 😎</p>
                <div id="password-line">
                    <input id="pass" type="password" name="pass" autofocus>
                    <button id="submitPass" type="button">➜</button>
                </div>
            </div>
            <div id="error-message-wrapper">
                    <span id="blank-placeholder" class="placeholder bottom-message">&#8203</span>
                    <span id="invalidPass" class="error bottom-message">You suck!</span>
                    <span id="trycatcherror" class="error bottom-message">Sorry, something went wrong.</span>
                    <span id="success" class="notifyText bottom-message">Success!</span>
            </div>
            <div id="securecontext" class="error">
                <p>Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.</p>
            </div>
            <div id="nocrypto" class="error">
                <p>Your web browser appears to be outdated. Please visit this page using a modern browser.</p>
            </div>
        </div>
</div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        var placeholder = document.getElementById('blank-placeholder');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                // successEl.style.display = "block";   //deleted by me
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 50); //changed by me from 1000 to 50
            } catch (e) {
                invalidPassEl.style.display = "block";  //i changed from display:inline to display:block
                placeholder.style.display = "none"; //added by me
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            placeholder.style.display = "block";    //added by me
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
